<html>
<head>
    <style>
        body {
            margin: 0;
        }

        iframe {
            border: none;
        }
    </style>
</head>
<body>
    <iframe id="chat_ttv_embed"
            src=""
            height="100%"
            width="100%">
    </iframe>
    <iframe id="chat_yt_embed"
            src=""
            height="100%"
            width="100%">
    </iframe>

    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function getLiveVideoID(channelId) {
            let videoId = null;

            try {
                const response = await fetch(`https://www.youtube.com/embed/live_stream?channel=${channelId}`);
                if (!response.ok) {
                    document.body.innerHTML = '<p>Nie mo¿na pobraæ danych...</p>' + document.body.innerHTML;
                    throw new Error('Nie mo¿na pobraæ danych...');
                }

                const data = await response.text();

                const matches = data.match(/'VIDEO_ID': "(.*?)"/);
                if (matches && matches[1]) {
                    videoId = matches[1];
                } else {
                    document.body.innerHTML = '<p>Nie mo¿na odnaleŸæ ID wideo...</p>' + document.body.innerHTML;
                    throw new Error('Nie mo¿na odnaleŸæ ID wideo...');
                }
            } catch (error) {
                document.body.innerHTML = `<p>ERROR: ${error.message}</p>` + document.body.innerHTML;
                throw new Error(error.message);
            }

            return videoId;
        }

        const twitchUser = getQueryParam('ttv');
        const youtubeUser = getQueryParam('yt');

        if (twitchUser) {
            const iframeTTV = document.getElementById('chat_ttv_embed');
            iframeTTV.src = `https://www.twitch.tv/embed/${twitchUser}/chat?darkpopout&parent=${window.location.hostname}`;
        } else {
            document.body.innerHTML = '<p>Brak nazwy u¿ytkownika Twitch w adresie URL!</p>' + document.body.innerHTML;
        }

        if (youtubeUser) {
            const iframeYT = document.getElementById('chat_yt_embed');

            (async () => {
                try {
                    const videoId = await getLiveVideoID(youtubeUser);

                    iframeYT.src = `https://www.youtube.com/live_chat?v=${videoId}&amp;embed_domain=${window.location.hostname}`;
                } catch (error) {
                    document.body.innerHTML = `<p>ERROR: ${error.message}</p>` + document.body.innerHTML;
                }
            })();
        } else {
            document.body.innerHTML = '<p>Brak nazwy u¿ytkownika YouTube w adresie URL!</p>' + document.body.innerHTML;
        }


    </script>
</body>
</html>