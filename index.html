<html>
<head>
    <style>
        body {
            margin: 0;
        }

        iframe {
            border: none;
        }
    </style>
</head>
<body>
    <iframe id="chat_ttv_embed"
            src=""
            height="100%"
            width="100%">
    </iframe>
    <iframe id="chat_yt_embed"
            src=""
            height="100%"
            width="100%">
    </iframe>
    <iframe id="video_yt_embed" style="display: none;" src=""></iframe>"
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        function getLiveVideoID() {

            try {
                const iframe = document.getElementById('video_yt_embed');
                if (!iframe) {
                    document.body.innerHTML = '<p>Nie znaleziono iframe...</p>' + document.body.innerHTML;
                    throw new Error('Nie znaleziono iframe...');
                }

                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                if (!iframeDoc) {
                    document.body.innerHTML = '<p>Nie mo¿na uzyskaæ zawartoœci iframe...</p>' + document.body.innerHTML;
                    throw new Error('Nie mo¿na uzyskaæ zawartoœci iframe...');
                }

                const iframeContent = iframeDoc.body.innerHTML;

                const matches = iframeContent.match(/'VIDEO_ID': "(.*?)"/);

                if (matches && matches[1]) {
                    videoId = matches[1];
                } else {
                    document.body.innerHTML = '<p>Nie mo¿na odnaleŸæ ID wideo w iframe...</p>' + document.body.innerHTML;
                    throw new Error('Nie mo¿na odnaleŸæ ID wideo w iframe...');
                }
            } catch (error) {
                throw new Error(error.message);
            }

            return videoId;
        }

        const twitchUser = getQueryParam('ttv');
        const youtubeUser = getQueryParam('yt');

        if (twitchUser) {
            const iframeTTV = document.getElementById('chat_ttv_embed');
            iframeTTV.src = `https://www.twitch.tv/embed/${twitchUser}/chat?darkpopout&parent=${window.location.hostname}`;
        } else {
            document.body.innerHTML = '<p>Brak nazwy u¿ytkownika Twitch w adresie URL!</p>' + document.body.innerHTML;
        }

        if (youtubeUser) {
            const iframeYT_chat = document.getElementById('chat_yt_embed');
            const iframeYT_video = document.getElementById('video_yt_embed');

            iframeYT_video.src = `https://www.youtube.com/embed/live_stream?channel=${youtubeUser}`;

            (async () => {
                try {
                    const videoId = await getLiveVideoID();

                    iframeYT_chat.src = `https://www.youtube.com/live_chat?is_popout=1&v=${videoId}&embed_domain=${window.location.hostname}`;
                } catch (error) {
                    document.body.innerHTML = `ERROR: ${error.message}` + document.body.innerHTML;
                }
            })();
        } else {
            document.body.innerHTML = '<p>Brak nazwy u¿ytkownika YouTube w adresie URL!</p>' + document.body.innerHTML;
        }


    </script>
</body>
</html>